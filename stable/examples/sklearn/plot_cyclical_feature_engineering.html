

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta property="og:title" content="Time-related feature engineering with scikit-learn" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.neuraxle.org/stable/examples/sklearn/plot_cyclical_feature_engineering.html" />
  <meta property="og:site_name" content="Neuraxle" />
  <meta property="og:description" content="This notebook introduces different strategies with Neuraxle to leverage time-related features for a bike sharing demand regression task that is highly dependent on business cycles (days, weeks, mon..." />
  <meta property="og:image" content="../../_images/binder_badge_logo.png" />
  <meta property="og:image:alt" content="Launch binder" />
  <meta property="og:locale" content="en_US" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Time-related feature engineering with scikit-learn &mdash; Neuraxle 0.7.0 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://www.neuraxle.org/examples/sklearn/plot_cyclical_feature_engineering.html"/>
  

  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PWQLPZ3');</script>
  <!-- End Google Tag Manager -->

  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="&gt;&gt;&gt; Complete API Documentation" href="../../api.html" />
    <link rel="prev" title="Boston Housing Regression with Meta Optimization" href="plot_boston_housing_meta_optimization.html" /> 

  <link href="https://fonts.googleapis.com/css?family=Share|Share+Tech+Mono" rel="stylesheet">
  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search > a {
      color: #ff6201;
    }
    .wy-side-nav-search > div.version {
      color: #ff6201;
    }
    .wy-side-nav-search, .wy-nav-top {
      color: #ff6201;
    }
    /* Sidebar */
    .wy-nav-side {
    }
  </style>
</head>

<body class="wy-body-for-nav">

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWQLPZ3"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #FCFCFC" >
          

          
            
              <a href="https://www.neuraxle.org/" class="icon">
                <img src="../../_static/neuraxle_logo.png" class="logo" alt="Logo"/>
              </a>
          

          
            <a href="https://www.neuraxio.com/" class="icon icon-home"> Neuraxio</a>/<a href="../../index.html" > Neuraxle
          
          </a>

          
            
            
              <div class="version">
                0.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About Neuraxle</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Neuraxle/README.html">Neuraxle Pipelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/README.html#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/README.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Neuraxle/README.html#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Neuraxle/README.html#license">License</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Neuraxle/README.html#citation">Citation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Neuraxle/README.html#contributors">Contributors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Neuraxle/README.html#supported-by">Supported By</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../comparison_to_other_frameworks.html">Comparison to Other Machine Learning Pipeline Frameworks, and Compatibility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../comparison_to_other_frameworks.html#scikit-learn">scikit-learn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../comparison_to_other_frameworks.html#apache-beam">Apache Beam</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../comparison_to_other_frameworks.html#spacy">spaCy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../comparison_to_other_frameworks.html#kubeflow">Kubeflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../comparison_to_other_frameworks.html#tensorflow">TensorFlow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../comparison_to_other_frameworks.html#hyperopt">Hyperopt</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../scikit-learn_problems_solutions.html">Solutions to Scikit-Learn’s Biggest Problems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#definitions">Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#inability-to-reasonably-do-automatic-machine-learning-automl">Inability to Reasonably do Automatic Machine Learning (AutoML)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-defining-the-search-space-hyperparameter-distributions">Problem: Defining the Search Space (Hyperparameter Distributions)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-defining-hyperparameters-in-the-constructor-is-limiting">Problem: Defining Hyperparameters in the Constructor is Limiting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-different-train-and-test-behavior">Problem: Different Train and Test Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-you-trained-a-pipeline-and-you-want-feedback-statistics-on-its-learning">Problem: You trained a Pipeline and You Want Feedback Statistics on its Learning</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#inability-to-reasonably-do-deep-learning-pipelines">Inability to Reasonably do Deep Learning Pipelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-scikit-learn-hardly-allows-for-mini-batch-gradient-descent-incremental-fit">Problem: Scikit-Learn Hardly Allows for Mini-Batch Gradient Descent (Incremental Fit)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-initializing-the-pipeline-and-deallocating-resources">Problem: Initializing the Pipeline and Deallocating Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-it-is-difficult-to-use-other-deep-learning-dl-libraries-in-scikit-learn">Problem: It is Difficult to Use Other Deep Learning (DL) Libraries in Scikit-Learn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-the-ability-to-transform-output-labels">Problem: The Ability to Transform Output Labels</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#not-ready-for-production-nor-for-complex-pipelines">Not ready for Production nor for Complex Pipelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-processing-3d-4d-or-nd-data-in-your-pipeline-with-steps-made-for-lower-dimensionnal-data">Problem: Processing 3D, 4D, or ND Data in your Pipeline with Steps Made for Lower-Dimensionnal Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-modify-a-pipeline-along-the-way-such-as-for-pre-training-or-fine-tuning">Problem: Modify a Pipeline Along the Way, such as for Pre-Training or Fine-Tuning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-getting-model-attributes-from-scikit-learn-pipeline">Problem: Getting Model Attributes from Scikit-Learn Pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../scikit-learn_problems_solutions.html#problem-you-can-t-parallelize-nor-save-pipelines-using-steps-that-can-t-be-serialized-as-is-by-joblib">Problem: You can’t Parallelize nor Save Pipelines Using Steps that Can’t be Serialized “as-is” by Joblib</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../awesome_neuraxle.html">Awesome Neuraxle </a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../awesome_neuraxle.html#contents">Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../awesome_neuraxle.html#examples-articles">Examples &amp; Articles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../awesome_neuraxle.html#courses-training">Courses &amp; Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../awesome_neuraxle.html#videos">Videos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../awesome_neuraxle.html#projects">Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../awesome_neuraxle.html#community">Community</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../awesome_neuraxle.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Neuraxle/CONTRIBUTING.html">Contributing to Neuraxle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/CONTRIBUTING.html#first-steps">First steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/CONTRIBUTING.html#before-coding">Before coding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/CONTRIBUTING.html#pull-requests">Pull Requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/CONTRIBUTING.html#code-reviews">Code Reviews</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/CONTRIBUTING.html#reviewing-other-s-code">Reviewing other’s code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/CONTRIBUTING.html#publishing-project-to-pypi">Publishing project to PyPI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Neuraxle/.github/CODE_OF_CONDUCT.html">Code of conduct</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/.github/CODE_OF_CONDUCT.html#respect">Respect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/.github/CODE_OF_CONDUCT.html#politeness">Politeness</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Neuraxle/.github/CODE_OF_CONDUCT.html#code-reviews">Code reviews</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../license.html">License</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../license.html#summary-of-the-license">Summary of the License</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs.html">&gt;&gt;&gt; Hands-On Walkthroughs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../intro.html">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../intro.html#encapsulate-models-and-data-transformers">Encapsulate Models and Data Transformers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro.html#pipe-and-filter">Pipe and Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro.html#wrapper-a-k-a-decorator-classes">Wrapper (a.k.a. Decorator) classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro.html#pipelines-for-minibatching-and-parallel-processing">Pipelines for Minibatching and Parallel Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro.html#repository-for-lazy-data-loading">Repository for lazy data loading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro.html#training-your-pipeline">Training your pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro.html#serializing-your-pipeline">Serializing your pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../classes_and_modules_overview.html">Class diagrams and inheritance charts of Neuraxle objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../classes_and_modules_overview.html#the-mixin-design-pattern-in-machine-learning">The Mixin design pattern in machine learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../classes_and_modules_overview.html#steps-containing-other-steps-as-the-composite-design-pattern-in-machine-learning">Steps containing other steps as the composite design pattern in machine learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../classes_and_modules_overview.html#scikit-learn-s-pipeline-pipeline-class-and-how-to-shift-to-parallel-deep-learning">Scikit-learn’s pipeline.Pipeline class and how to shift to parallel deep learning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../classes_and_modules_overview.html#examples-using-neuraxle-pipeline-pipeline">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.pipeline.Pipeline</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../classes_and_modules_overview.html#examples-using-neuraxle-distributed-streaming-sequentialqueuedpipeline">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.distributed.streaming.SequentialQueuedPipeline</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../classes_and_modules_overview.html#featureunion-to-compute-steps-in-parallel-and-join-their-results">FeatureUnion to compute steps in parallel and join their results</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../classes_and_modules_overview.html#examples-using-neuraxle-union-featureunion">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.union.FeatureUnion</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../classes_and_modules_overview.html#automl-module-to-automatically-tune-hyperparameters-of-your-pipelines">AutoML module to automatically tune hyperparameters of your pipelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../classes_and_modules_overview.html#examples-using-neuraxle-metaopt-auto-ml-automl">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.metaopt.auto_ml.AutoML</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../classes_and_modules_overview.html#all-the-base-classes-of-neuraxle-together">All the base classes of Neuraxle together</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../hyperparameter_tuning.html">Automatic Hyperparameter Tuning / AutoML</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hyperparameter_tuning.html#AutoML-loop">AutoML loop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../hyperparameter_tuning.html#Define-your-problem">Define your problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hyperparameter_tuning.html#Define-your-pipeline">Define your pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hyperparameter_tuning.html#Choose-a-validation-splitter">Choose a validation splitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hyperparameter_tuning.html#Define-a-the-main-scoring-metric-with-ScoringCallback">Define a the main scoring metric with ScoringCallback</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hyperparameter_tuning.html#Add-other-metric-callbacks-with-MetricCallback-(optional)">Add other metric callbacks with MetricCallback (optional)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hyperparameter_tuning.html#Select-an-hyperparams-repository">Select an hyperparams repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hyperparameter_tuning.html#Select-an-hyperparams-optimizer">Select an hyperparams optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hyperparameter_tuning.html#Create,-and-launch-AutoML-loop">Create, and launch AutoML loop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hyperparameter_tuning.html#Get-best-model-and-measure-test-accuracy">Get best model and measure test accuracy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hyperparameter_tuning.html#Additional-note-:-model-selection-as-an-hyperparameter">Additional note : model selection as an hyperparameter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../handler_methods.html">Handler Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#handle_fit_transform">handle_fit_transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#handle_fit">handle_fit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#handle_transform">handle_transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#When-to-use-handler-methods-?">When to use handler methods ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#HandleOnlyMixin">HandleOnlyMixin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#ForceHandleMixin">ForceHandleMixin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#ForceHandleOnlyMixin">ForceHandleOnlyMixin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../handler_methods.html#Examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#ForEach">ForEach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#ToNumpy">ToNumpy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#Transform-Expected-Outputs">Transform Expected Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#Expand-The-DataContainer">Expand The DataContainer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../handler_methods.html#Reversible-Pipeline">Reversible Pipeline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../step_saving_and_lifecycle.html">Step Saving &amp; Lifecycle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../step_saving_and_lifecycle.html#Lifecycle">Lifecycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../step_saving_and_lifecycle.html#Step-Saving">Step Saving</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../step_saving_and_lifecycle.html#Saver">Saver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../step_saving_and_lifecycle.html#Custom-Saver-Example">Custom Saver Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../step_saving_and_lifecycle.html#Saving-Example">Saving Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../step_saving_and_lifecycle.html#Pipeline">Pipeline</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../step_saving_and_lifecycle.html#Full-Dump-Saving">Full Dump Saving</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../step_saving_and_lifecycle.html#Full-Dump-Loading">Full Dump Loading</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../time_series_processing.html">Time Series Processing Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../time_series_processing.html#The-Dataset">The Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../time_series_processing.html#The-task">The task</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../time_series_processing.html#Video-dataset-overview">Video dataset overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../time_series_processing.html#Details-about-the-input-data">Details about the input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../time_series_processing.html#Loading-the-Dataset">Loading the Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../time_series_processing.html#Part-1---How-would-you-code-this-in-a-typical-ML-project-using-Scikit-learn">Part 1 - How would you code this in a typical ML project using Scikit-learn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../time_series_processing.html#Part-2---How-to-code-a-similar-pipeline---but-cleaner---using-Neuraxle">Part 2 - How to code a similar pipeline - but cleaner - using Neuraxle</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../random_distributions.html">Random Distributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../random_distributions.html#Plotting-Each-Hyperparameter-Distribution">Plotting Each Hyperparameter Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../random_distributions.html#Discrete-Distributions">Discrete Distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#RandInt">RandInt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Boolean">Boolean</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Choice">Choice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Priority-Choice">Priority Choice</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../random_distributions.html#Continuous-Distributions">Continuous Distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Continuous-Uniform">Continuous Uniform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Continuous-Loguniform">Continuous Loguniform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Continuous-Normal">Continuous Normal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Continuous-Lognormal">Continuous Lognormal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Continuous-Normal-Clipped">Continuous Normal Clipped</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Continuous-Lognormal-Clipped">Continuous Lognormal Clipped</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../random_distributions.html#Quantized-Hyperparameter-Distributions">Quantized Hyperparameter Distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Quantized-Uniform">Quantized Uniform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Repaired-Quantized-Uniform">Repaired Quantized Uniform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Quantized-Log-Uniform">Quantized Log Uniform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Quantized-Normal">Quantized Normal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#Quantized-Lognormal">Quantized Lognormal</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../random_distributions.html#Creating-your-own-distributions">Creating your own distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../random_distributions.html#Using-Scipy-Distributions">Using Scipy Distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../random_distributions.html#Creating-your-own-distributions-using-scipy">Creating your own distributions using scipy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#BaseCustomContinuousScipyDistribution">BaseCustomContinuousScipyDistribution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../random_distributions.html#BaseCustomDiscreteScipyDistribution">BaseCustomDiscreteScipyDistribution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../rest_api_serving.html">REST API Serving</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../rest_api_serving.html#Import-Packages">Import Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rest_api_serving.html#Load-your-Dataset">Load your Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rest_api_serving.html#Create-your-Pipeline">Create your Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rest_api_serving.html#Let's-Train-and-Test">Let’s Train and Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rest_api_serving.html#Deploy-the-Pipeline">Deploy the Pipeline</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../rest_api_serving.html#Write-a-step-to-decode-the-accepted-JSON-as-data-inputs">Write a step to decode the accepted JSON as data inputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../rest_api_serving.html#Write-a-step-to-encode-the-returned-JSON-response">Write a step to encode the returned JSON response</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../rest_api_serving.html#Finally-Serve-Predictions">Finally Serve Predictions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../rest_api_serving.html#API-Call-Example">API Call Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rest_api_serving.html#Next-Steps">Next Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../rest_api_serving.html#Pipeline-Serialization">Pipeline Serialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../rest_api_serving.html#Data-Transformation-Caching">Data Transformation Caching</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../rest_api_serving.html#Checkpoints">Checkpoints</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">&gt;&gt;&gt; Practical Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#automl">AutoML</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_ml/plot_automl_loop_clean_kata.html">Usage of AutoML loop, and hyperparams with sklearn models.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#caching">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#rest-api-model-serving">REST API Model Serving</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../deployment/plot_easy_rest_api_serving.html">Easy REST API Model Serving with Neuraxle</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#getting-started">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/plot_inverse_transform.html">Inverse Transforms in Neuraxle: How to Reverse a Prediction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/plot_nested_pipelines.html">Create Nested Pipelines in Neuraxle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/plot_label_encoder_across_multiple_columns.html">Create label encoder across multiple columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/plot_non_fittable_mixin.html">Create Pipeline Steps in Neuraxle that doesn’t fit or transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/plot_force_handle_mixin.html">Create Pipeline Steps that require implementing only handler methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#hyperparameters">Hyperparameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../hyperparams/plot_hyperparams.html">Manipulate Hyperparameter Spaces for Hyperparameter Tuning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#parallel">Parallel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../parallel/plot_streaming_pipeline.html">Parallel processing in Neuraxle</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#neuraxle-hyperparameter-examples">Neuraxle hyperparameter examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_boston_housing_regression_with_model_stacking.html">Boston Housing Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_boston_housing_meta_optimization.html">Boston Housing Regression with Meta Optimization</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Time-related feature engineering with scikit-learn</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#data-exploration-on-the-bike-sharing-demand-dataset">Data exploration on the Bike Sharing Demand dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-based-cross-validation">Time-based cross-validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gradient-boosting">Gradient Boosting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#naive-linear-regression">Naive linear regression</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-steps-as-categories">Time-steps as categories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#trigonometric-features">Trigonometric features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#periodic-spline-features">Periodic spline features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#qualitative-analysis-of-the-impact-of-features-on-linear-model-predictions">Qualitative analysis of the impact of features on linear model predictions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modeling-pairwise-interactions-with-splines-and-polynomial-features">Modeling pairwise interactions with splines and polynomial features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modeling-non-linear-feature-interactions-with-kernels">Modeling non-linear feature interactions with kernels</a></li>
<li class="toctree-l4"><a class="reference internal" href="#concluding-remarks">Concluding remarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source">Source</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">&gt;&gt;&gt; Complete API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/neuraxle.base.html">neuraxle.base</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/neuraxle.base.html#neuraxle-s-base-classes">Neuraxle’s Base Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.base.html#examples-using-neuraxle-base-basestep">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.base.BaseStep</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.base.html#examples-using-neuraxle-base-executioncontext">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.base.ExecutionContext</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.base.html#examples-using-neuraxle-base-forcehandlemixin">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.base.ForceHandleMixin</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.base.html#examples-using-neuraxle-base-identity">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.base.Identity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.base.html#examples-using-neuraxle-base-metastep">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.base.MetaStep</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.base.html#examples-using-neuraxle-base-nonfittablemixin">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.base.NonFittableMixin</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.base.html#examples-using-neuraxle-base-nontransformablemixin">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.base.NonTransformableMixin</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/neuraxle.pipeline.html">neuraxle.pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/neuraxle.pipeline.html#neuraxle-s-pipeline-classes">Neuraxle’s Pipeline Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.pipeline.html#examples-using-neuraxle-pipeline-basepipeline">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.pipeline.BasePipeline</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.pipeline.html#examples-using-neuraxle-pipeline-minibatchsequentialpipeline">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.pipeline.MiniBatchSequentialPipeline</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.pipeline.html#examples-using-neuraxle-pipeline-pipeline">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.pipeline.Pipeline</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/neuraxle.data_container.html">neuraxle.data_container</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/neuraxle.data_container.html#neuraxle-s-datacontainer-classes">Neuraxle’s DataContainer classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/neuraxle.union.html">neuraxle.union</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/neuraxle.union.html#union-of-features">Union of Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.union.html#examples-using-neuraxle-union-addfeatures">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.union.AddFeatures</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.union.html#examples-using-neuraxle-union-featureunion">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.union.FeatureUnion</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/neuraxle.union.html#examples-using-neuraxle-union-modelstacking">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.union.ModelStacking</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/steps/neuraxle.steps.numpy.html">neuraxle.steps.numpy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/steps/neuraxle.steps.numpy.html#pipeline-steps-based-on-numpy">Pipeline Steps Based on NumPy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.numpy.html#examples-using-neuraxle-steps-numpy-multiplybyn">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.numpy.MultiplyByN</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.numpy.html#examples-using-neuraxle-steps-numpy-numpyravel">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.numpy.NumpyRavel</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.numpy.html#examples-using-neuraxle-steps-numpy-numpyshapeprinter">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.numpy.NumpyShapePrinter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.numpy.html#examples-using-neuraxle-steps-numpy-numpytranspose">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.numpy.NumpyTranspose</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/steps/neuraxle.steps.flow.html">neuraxle.steps.flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/steps/neuraxle.steps.flow.html#neuraxle-s-flow-steps">Neuraxle’s Flow Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.flow.html#examples-using-neuraxle-steps-flow-chooseonestepof">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.flow.ChooseOneStepOf</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/steps/neuraxle.steps.data.html">neuraxle.steps.data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/steps/neuraxle.steps.data.html#data-steps">Data Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/steps/neuraxle.steps.column_transformer.html">neuraxle.steps.column_transformer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/steps/neuraxle.steps.column_transformer.html#neuraxle-s-column-transformer-steps">Neuraxle’s Column Transformer Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.column_transformer.html#examples-using-neuraxle-steps-column-transformer-columntransformer">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.column_transformer.ColumnTransformer</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/steps/neuraxle.steps.features.html">neuraxle.steps.features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/steps/neuraxle.steps.features.html#featurization-steps">Featurization Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/steps/neuraxle.steps.sklearn.html">neuraxle.steps.sklearn</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/steps/neuraxle.steps.sklearn.html#pipeline-steps-based-on-scikit-learn">Pipeline Steps Based on Scikit-Learn</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.sklearn.html#examples-using-neuraxle-steps-sklearn-ridgemodelstacking">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.sklearn.RidgeModelStacking</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.sklearn.html#examples-using-neuraxle-steps-sklearn-sklearnwrapper">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.sklearn.SKLearnWrapper</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/steps/neuraxle.steps.loop.html">neuraxle.steps.loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/steps/neuraxle.steps.loop.html#pipeline-steps-for-looping">Pipeline Steps For Looping</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.loop.html#examples-using-neuraxle-steps-loop-flattenforeach">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.loop.FlattenForEach</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.loop.html#examples-using-neuraxle-steps-loop-foreach">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.loop.ForEach</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/steps/neuraxle.steps.output_handlers.html">neuraxle.steps.output_handlers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/steps/neuraxle.steps.output_handlers.html#output-handlers-steps">Output Handlers Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.output_handlers.html#examples-using-neuraxle-steps-output-handlers-outputtransformerwrapper">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.output_handlers.OutputTransformerWrapper</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/steps/neuraxle.steps.misc.html">neuraxle.steps.misc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/steps/neuraxle.steps.misc.html#miscelaneous-pipeline-steps">Miscelaneous Pipeline Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/steps/neuraxle.steps.misc.html#examples-using-neuraxle-steps-misc-sleep">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.steps.misc.Sleep</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hyperparams/neuraxle.hyperparams.distributions.html">neuraxle.hyperparams.distributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/hyperparams/neuraxle.hyperparams.distributions.html#hyperparameter-distributions">Hyperparameter Distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/hyperparams/neuraxle.hyperparams.distributions.html#examples-using-neuraxle-hyperparams-distributions-boolean">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.hyperparams.distributions.Boolean</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hyperparams/neuraxle.hyperparams.distributions.html#examples-using-neuraxle-hyperparams-distributions-choice">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.hyperparams.distributions.Choice</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hyperparams/neuraxle.hyperparams.distributions.html#examples-using-neuraxle-hyperparams-distributions-loguniform">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.hyperparams.distributions.LogUniform</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/hyperparams/neuraxle.hyperparams.distributions.html#examples-using-neuraxle-hyperparams-distributions-randint">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.hyperparams.distributions.RandInt</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hyperparams/neuraxle.hyperparams.scipy_distributions.html">neuraxle.hyperparams.scipy_distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/hyperparams/neuraxle.hyperparams.space.html">neuraxle.hyperparams.space</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/hyperparams/neuraxle.hyperparams.space.html#hyperparameter-dictionary-conversions">Hyperparameter Dictionary Conversions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/hyperparams/neuraxle.hyperparams.space.html#examples-using-neuraxle-hyperparams-space-hyperparameterspace">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.hyperparams.space.HyperparameterSpace</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.auto_ml.html">neuraxle.metaopt.auto_ml</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.auto_ml.html#neuraxle-s-automl-classes">Neuraxle’s AutoML Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.auto_ml.html#examples-using-neuraxle-metaopt-auto-ml-automl">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.metaopt.auto_ml.AutoML</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.validation.html">neuraxle.metaopt.validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.validation.html#validation">Validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.callbacks.html">neuraxle.metaopt.callbacks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.callbacks.html#neuraxle-s-training-callbacks-classes">Neuraxle’s training callbacks classes.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.callbacks.html#examples-using-neuraxle-metaopt-callbacks-metriccallback">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.metaopt.callbacks.MetricCallback</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.callbacks.html#examples-using-neuraxle-metaopt-callbacks-scoringcallback">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.metaopt.callbacks.ScoringCallback</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.observable.html">neuraxle.metaopt.observable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/metaopt/neuraxle.metaopt.observable.html#neuraxle-s-observable-classes">Neuraxle’s Observable Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/metaopt/data/neuraxle.metaopt.data.vanilla.html">neuraxle.metaopt.data.vanilla</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/metaopt/data/neuraxle.metaopt.data.vanilla.html#neuraxle-s-base-hyperparameter-repository-classes">Neuraxle’s Base Hyperparameter Repository Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/metaopt/data/neuraxle.metaopt.data.aggregates.html">neuraxle.metaopt.data.aggregates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/metaopt/data/neuraxle.metaopt.data.aggregates.html#neuraxle-s-automl-scope-manager-classes">Neuraxle’s AutoML Scope Manager Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/metaopt/data/neuraxle.metaopt.data.json_repo.html">neuraxle.metaopt.data.json_repo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/metaopt/data/neuraxle.metaopt.data.json_repo.html#neuraxle-s-json-hyperparameter-repository-classes">Neuraxle’s JSON Hyperparameter Repository Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/metaopt/data/neuraxle.metaopt.data.json_repo.html#examples-using-neuraxle-metaopt-data-json-repo-hyperparamsondiskrepository">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.metaopt.data.json_repo.HyperparamsOnDiskRepository</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/metaopt/hyperopt/neuraxle.metaopt.hyperopt.tpe.html">neuraxle.metaopt.hyperopt.tpe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/metaopt/hyperopt/neuraxle.metaopt.hyperopt.tpe.html#tree-parzen-estimator">Tree parzen estimator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/distributed/neuraxle.distributed.streaming.html">neuraxle.distributed.streaming</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributed/neuraxle.distributed.streaming.html#streaming-pipelines-for-parallel-and-queued-data-processing">Streaming Pipelines for Parallel and Queued Data Processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/distributed/neuraxle.distributed.streaming.html#examples-using-neuraxle-distributed-streaming-sequentialqueuedpipeline">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.distributed.streaming.SequentialQueuedPipeline</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/logging/neuraxle.logging.logging.html">neuraxle.logging.logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/logging/neuraxle.logging.logging.html#neuraxle-s-logging-module">Neuraxle’s Logging module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/logging/neuraxle.logging.warnings.html">neuraxle.logging.warnings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/logging/neuraxle.logging.warnings.html#neuraxle-s-deprecation-warnings">Neuraxle’s Deprecation Warnings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/rest/neuraxle.rest.flask.html">neuraxle.rest.flask</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/rest/neuraxle.rest.flask.html#neuraxle-s-flask-wrapper-classes">Neuraxle’s Flask Wrapper classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/rest/neuraxle.rest.flask.html#examples-using-neuraxle-rest-flask-flaskrestapiwrapper">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.rest.flask.FlaskRestApiWrapper</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rest/neuraxle.rest.flask.html#examples-using-neuraxle-rest-flask-jsondatabodydecoder">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.rest.flask.JSONDataBodyDecoder</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/rest/neuraxle.rest.flask.html#examples-using-neuraxle-rest-flask-jsondataresponseencoder">Examples using <code class="docutils literal notranslate"><span class="pre">neuraxle.rest.flask.JSONDataResponseEncoder</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          <li class="toctree-l1">
            <a class="reference internal" href="https://www.neuraxio.com/blogs/news"
                                    style="background:#ff6201; color:#fff; text-decoration-line: underline;" target="_blank">
            Neuraxio Blog Articles [↗️]</a>
            <a class="reference internal" href="https://www.neuraxio.com/blogs/news/our-top-learning-resources-for-ai-programmers?utm_source=neuraxle_doc"
                                    style="background:#ffaf00; color:#fff; text-decoration-line: underline;" target="_blank">
            Learn AI Programming [↗️]</a>
            <a class="reference internal" href="https://www.jobs.neuraxio.com/"
                                    style="background:#111; color:#fff; text-decoration-line: underline;" target="_blank">
            Jobs [↗️]</a>
          </li>

          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="https://www.neuraxio.com/"> Neuraxio</a>/<a href="../../index.html">Neuraxle</a>
        
      </nav>


      <div class="wy-nav-content">
        <a href="https://github.com/Neuraxio/Neuraxle"><img style="position: absolute; border: 0; top: 0; right: 0;" width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">&gt;&gt;&gt; Practical Examples</a> &raquo;</li>
        
      <li>Time-related feature engineering with scikit-learn</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <!-- <a href="../../_sources/examples/sklearn/plot_cyclical_feature_engineering.rst.txt" rel="nofollow"> View page source</a> -->
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-sklearn-plot-cyclical-feature-engineering-py"><span class="std std-ref">here</span></a>
to download the full example code or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="time-related-feature-engineering-with-scikit-learn">
<span id="sphx-glr-examples-sklearn-plot-cyclical-feature-engineering-py"></span><h1>Time-related feature engineering with scikit-learn<a class="headerlink" href="#time-related-feature-engineering-with-scikit-learn" title="Permalink to this headline">¶</a></h1>
<p>This notebook introduces different strategies with Neuraxle to leverage time-related features
for a bike sharing demand regression task that is highly dependent on business
cycles (days, weeks, months) and yearly season cycles.</p>
<p>In the process, we introduce how to perform periodic feature engineering using
the <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.SplineTransformer.html#sklearn.preprocessing.SplineTransformer" title="(in scikit-learn v1.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.preprocessing.SplineTransformer</span></code></a> class and its
<cite>extrapolation=”periodic”</cite> option.</p>
<p>Machine Learning Pipelines are built using the <a class="reference internal" href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pipeline</span></code></a> class,
as well as <a class="reference internal" href="../../api/steps/neuraxle.steps.column_transformer.html#neuraxle.steps.column_transformer.ColumnTransformer" title="neuraxle.steps.column_transformer.ColumnTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnTransformer</span></code></a>
and <a class="reference internal" href="../../api/neuraxle.union.html#neuraxle.union.FeatureUnion" title="neuraxle.union.FeatureUnion"><code class="xref py py-class docutils literal notranslate"><span class="pre">FeatureUnion</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<section id="data-exploration-on-the-bike-sharing-demand-dataset">
<h2>Data exploration on the Bike Sharing Demand dataset<a class="headerlink" href="#data-exploration-on-the-bike-sharing-demand-dataset" title="Permalink to this headline">¶</a></h2>
<p>We start by loading the data from the OpenML repository.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">neuraxle.base</span> <span class="kn">import</span> <a href="../../api/neuraxle.base.html#neuraxle.base.Identity" title="neuraxle.base.Identity" class="sphx-glr-backref-module-neuraxle-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Identity</span></a><span class="p">,</span> <a href="../../api/neuraxle.base.html#neuraxle.base.MetaStep" title="neuraxle.base.MetaStep" class="sphx-glr-backref-module-neuraxle-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MetaStep</span></a>
<span class="kn">from</span> <span class="nn">neuraxle.pipeline</span> <span class="kn">import</span> <a href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline" class="sphx-glr-backref-module-neuraxle-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Pipeline</span></a>
<span class="kn">from</span> <span class="nn">neuraxle.steps.column_transformer</span> <span class="kn">import</span> <a href="../../api/steps/neuraxle.steps.column_transformer.html#neuraxle.steps.column_transformer.ColumnTransformer" title="neuraxle.steps.column_transformer.ColumnTransformer" class="sphx-glr-backref-module-neuraxle-steps-column_transformer sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ColumnTransformer</span></a>
<span class="kn">from</span> <span class="nn">neuraxle.union</span> <span class="kn">import</span> <a href="../../api/neuraxle.union.html#neuraxle.union.FeatureUnion" title="neuraxle.union.FeatureUnion" class="sphx-glr-backref-module-neuraxle-union sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">FeatureUnion</span></a>

<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.fetch_openml.html#sklearn.datasets.fetch_openml" title="sklearn.datasets.fetch_openml" class="sphx-glr-backref-module-sklearn-datasets sphx-glr-backref-type-py-function"><span class="n">fetch_openml</span></a>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingRegressor.html#sklearn.ensemble.HistGradientBoostingRegressor" title="sklearn.ensemble.HistGradientBoostingRegressor" class="sphx-glr-backref-module-sklearn-ensemble sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">HistGradientBoostingRegressor</span></a>
<span class="kn">from</span> <span class="nn">sklearn.kernel_approximation</span> <span class="kn">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.kernel_approximation.Nystroem.html#sklearn.kernel_approximation.Nystroem" title="sklearn.kernel_approximation.Nystroem" class="sphx-glr-backref-module-sklearn-kernel_approximation sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Nystroem</span></a>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeCV.html#sklearn.linear_model.RidgeCV" title="sklearn.linear_model.RidgeCV" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RidgeCV</span></a>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.TimeSeriesSplit.html#sklearn.model_selection.TimeSeriesSplit" title="sklearn.model_selection.TimeSeriesSplit" class="sphx-glr-backref-module-sklearn-model_selection sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">TimeSeriesSplit</span></a><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_validate.html#sklearn.model_selection.cross_validate" title="sklearn.model_selection.cross_validate" class="sphx-glr-backref-module-sklearn-model_selection sphx-glr-backref-type-py-function"><span class="n">cross_validate</span></a>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="p">(</span><a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.FunctionTransformer.html#sklearn.preprocessing.FunctionTransformer" title="sklearn.preprocessing.FunctionTransformer" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">FunctionTransformer</span></a><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html#sklearn.preprocessing.MinMaxScaler" title="sklearn.preprocessing.MinMaxScaler" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MinMaxScaler</span></a><span class="p">,</span>
                                   <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder" title="sklearn.preprocessing.OneHotEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">OneHotEncoder</span></a><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OrdinalEncoder.html#sklearn.preprocessing.OrdinalEncoder" title="sklearn.preprocessing.OrdinalEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">OrdinalEncoder</span></a><span class="p">,</span>
                                   <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.PolynomialFeatures.html#sklearn.preprocessing.PolynomialFeatures" title="sklearn.preprocessing.PolynomialFeatures" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">PolynomialFeatures</span></a><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.SplineTransformer.html#sklearn.preprocessing.SplineTransformer" title="sklearn.preprocessing.SplineTransformer" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">SplineTransformer</span></a><span class="p">)</span>

<span class="n">bike_sharing</span> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.fetch_openml.html#sklearn.datasets.fetch_openml" title="sklearn.datasets.fetch_openml" class="sphx-glr-backref-module-sklearn-datasets sphx-glr-backref-type-py-function"><span class="n">fetch_openml</span></a><span class="p">(</span><span class="s2">&quot;Bike_Sharing_Demand&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">bike_sharing</span><span class="o">.</span><span class="n">frame</span>
</pre></div>
</div>
<p>To get a quick understanding of the periodic patterns of the data, let us
have a look at the average demand per hour during a week.</p>
<p>Note that the week starts on a Sunday, during the weekend. We can clearly
distinguish the commute patterns in the morning and evenings of the work days
and the leisure use of the bikes on the weekends with a more spread peak
demand around the middle of the days:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">average_week_demand</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
<span class="n">average_week_demand</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Average hourly bike demand during the week&quot;</span><span class="p">,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">24</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)],</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="s2">&quot;Mon&quot;</span><span class="p">,</span> <span class="s2">&quot;Tue&quot;</span><span class="p">,</span> <span class="s2">&quot;Wed&quot;</span><span class="p">,</span> <span class="s2">&quot;Thu&quot;</span><span class="p">,</span> <span class="s2">&quot;Fri&quot;</span><span class="p">,</span> <span class="s2">&quot;Sat&quot;</span><span class="p">],</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time of the week&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Number of bike rentals&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_cyclical_feature_engineering_001.png" srcset="../../_images/sphx_glr_plot_cyclical_feature_engineering_001.png" alt="Average hourly bike demand during the week" class = "sphx-glr-single-img"/><p>The target of the prediction problem is the absolute count of bike rentals on
a hourly basis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>977.0
</pre></div>
</div>
<p>Let us rescale the target variable (number of hourly bike rentals) to predict
a relative demand so that the mean absolute error is more easily interpreted
as a fraction of the maximum demand.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The fit method of the models used in this notebook all minimize the
mean squared error to estimate the conditional mean instead of the mean
absolute error that would fit an estimator of the conditional median.</p>
<p>When reporting performance measure on the test set in the discussion, we
instead choose to focus on the mean absolute error that is more
intuitive than the (root) mean squared error. Note, however, that the
best models for one metric are also the best for the other in this
study.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">y</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Fraction of rented fleet demand&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Number of hours&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_cyclical_feature_engineering_002.png" srcset="../../_images/sphx_glr_plot_cyclical_feature_engineering_002.png" alt="plot cyclical feature engineering" class = "sphx-glr-single-img"/><p>The input feature data frame is a time annotated hourly log of variables
describing the weather conditions. It includes both numerical and categorical
variables. Note that the time information has already been expanded into
several complementary columns.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span>
<span class="n">X</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>year</th>
      <th>month</th>
      <th>hour</th>
      <th>holiday</th>
      <th>weekday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>feel_temp</th>
      <th>humidity</th>
      <th>windspeed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>spring</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>clear</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>0.81</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>spring</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>clear</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>0.80</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>spring</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>clear</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>0.80</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>spring</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>clear</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>0.75</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>spring</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>clear</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>0.75</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17374</th>
      <td>spring</td>
      <td>1.0</td>
      <td>12.0</td>
      <td>19.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>misty</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>0.60</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>17375</th>
      <td>spring</td>
      <td>1.0</td>
      <td>12.0</td>
      <td>20.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>misty</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>0.60</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>17376</th>
      <td>spring</td>
      <td>1.0</td>
      <td>12.0</td>
      <td>21.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>0.60</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>17377</th>
      <td>spring</td>
      <td>1.0</td>
      <td>12.0</td>
      <td>22.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>0.56</td>
      <td>8.9981</td>
    </tr>
    <tr>
      <th>17378</th>
      <td>spring</td>
      <td>1.0</td>
      <td>12.0</td>
      <td>23.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>0.65</td>
      <td>8.9981</td>
    </tr>
  </tbody>
</table>
<p>17379 rows × 12 columns</p>
</div>
</div>
<br />
<br /><div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the time information was only present as a date or datetime column, we
could have expanded it into hour-in-the-day, day-in-the-week,
day-in-the-month, month-in-the-year using pandas:
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#time-date-components">https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#time-date-components</a></p>
</div>
<p>We now introspect the distribution of the categorical variables, starting
with <cite>“weather”</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>clear         11413
misty          4544
rain           1419
heavy_rain        3
Name: weather, dtype: int64
</pre></div>
</div>
<p>Since there are only 3 <cite>“heavy_rain”</cite> events, we cannot use this category to
train machine learning models with cross validation. Instead, we simplify the
representation by collapsing those into the <cite>“rain”</cite> category.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="s2">&quot;heavy_rain&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;rain&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>clear    11413
misty     4544
rain      1422
Name: weather, dtype: int64
</pre></div>
</div>
<p>As expected, the <cite>“season”</cite> variable is well balanced:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>fall      4496
summer    4409
spring    4242
winter    4232
Name: season, dtype: int64
</pre></div>
</div>
</section>
<section id="time-based-cross-validation">
<h2>Time-based cross-validation<a class="headerlink" href="#time-based-cross-validation" title="Permalink to this headline">¶</a></h2>
<p>Since the dataset is a time-ordered event log (hourly demand), we will use a
time-sensitive cross-validation splitter to evaluate our demand forecasting
model as realistically as possible. We use a gap of 2 days between the train
and test side of the splits. We also limit the training set size to make the
performance of the CV folds more stable.</p>
<p>1000 test datapoints should be enough to quantify the performance of the
model. This represents a bit less than a month and a half of contiguous test
data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ts_cv</span> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.TimeSeriesSplit.html#sklearn.model_selection.TimeSeriesSplit" title="sklearn.model_selection.TimeSeriesSplit" class="sphx-glr-backref-module-sklearn-model_selection sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">TimeSeriesSplit</span></a><span class="p">(</span>
    <span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">gap</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span>
    <span class="n">max_train_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">test_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Let us manually inspect the various splits to check that the
<cite>TimeSeriesSplit</cite> works as we expect, starting with the first split:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">all_splits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ts_cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">train_0</span><span class="p">,</span> <span class="n">test_0</span> <span class="o">=</span> <span class="n">all_splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">]</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>year</th>
      <th>month</th>
      <th>hour</th>
      <th>holiday</th>
      <th>weekday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>feel_temp</th>
      <th>humidity</th>
      <th>windspeed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12379</th>
      <td>summer</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>clear</td>
      <td>22.14</td>
      <td>25.760</td>
      <td>0.68</td>
      <td>27.9993</td>
    </tr>
    <tr>
      <th>12380</th>
      <td>summer</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>misty</td>
      <td>21.32</td>
      <td>25.000</td>
      <td>0.77</td>
      <td>22.0028</td>
    </tr>
    <tr>
      <th>12381</th>
      <td>summer</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>2.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>rain</td>
      <td>21.32</td>
      <td>25.000</td>
      <td>0.72</td>
      <td>19.9995</td>
    </tr>
    <tr>
      <th>12382</th>
      <td>summer</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>rain</td>
      <td>20.50</td>
      <td>24.240</td>
      <td>0.82</td>
      <td>12.9980</td>
    </tr>
    <tr>
      <th>12383</th>
      <td>summer</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>4.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>rain</td>
      <td>20.50</td>
      <td>24.240</td>
      <td>0.82</td>
      <td>12.9980</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>13374</th>
      <td>fall</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>11.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>34.44</td>
      <td>40.150</td>
      <td>0.53</td>
      <td>15.0013</td>
    </tr>
    <tr>
      <th>13375</th>
      <td>fall</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>12.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>34.44</td>
      <td>39.395</td>
      <td>0.49</td>
      <td>8.9981</td>
    </tr>
    <tr>
      <th>13376</th>
      <td>fall</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>13.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>34.44</td>
      <td>39.395</td>
      <td>0.49</td>
      <td>19.0012</td>
    </tr>
    <tr>
      <th>13377</th>
      <td>fall</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>14.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>36.08</td>
      <td>40.910</td>
      <td>0.42</td>
      <td>7.0015</td>
    </tr>
    <tr>
      <th>13378</th>
      <td>fall</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>15.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>35.26</td>
      <td>40.150</td>
      <td>0.47</td>
      <td>16.9979</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 12 columns</p>
</div>
</div>
<br />
<br /><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">]</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>year</th>
      <th>month</th>
      <th>hour</th>
      <th>holiday</th>
      <th>weekday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>feel_temp</th>
      <th>humidity</th>
      <th>windspeed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2331</th>
      <td>summer</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>misty</td>
      <td>25.42</td>
      <td>31.060</td>
      <td>0.50</td>
      <td>6.0032</td>
    </tr>
    <tr>
      <th>2332</th>
      <td>summer</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>misty</td>
      <td>24.60</td>
      <td>31.060</td>
      <td>0.53</td>
      <td>8.9981</td>
    </tr>
    <tr>
      <th>2333</th>
      <td>summer</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>misty</td>
      <td>23.78</td>
      <td>27.275</td>
      <td>0.56</td>
      <td>8.9981</td>
    </tr>
    <tr>
      <th>2334</th>
      <td>summer</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>misty</td>
      <td>22.96</td>
      <td>26.515</td>
      <td>0.64</td>
      <td>8.9981</td>
    </tr>
    <tr>
      <th>2335</th>
      <td>summer</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>misty</td>
      <td>22.14</td>
      <td>25.760</td>
      <td>0.68</td>
      <td>8.9981</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>12326</th>
      <td>summer</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>19.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>clear</td>
      <td>26.24</td>
      <td>31.060</td>
      <td>0.36</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>12327</th>
      <td>summer</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>20.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>clear</td>
      <td>25.42</td>
      <td>31.060</td>
      <td>0.35</td>
      <td>19.0012</td>
    </tr>
    <tr>
      <th>12328</th>
      <td>summer</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>21.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>clear</td>
      <td>24.60</td>
      <td>31.060</td>
      <td>0.40</td>
      <td>7.0015</td>
    </tr>
    <tr>
      <th>12329</th>
      <td>summer</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>22.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>clear</td>
      <td>23.78</td>
      <td>27.275</td>
      <td>0.46</td>
      <td>8.9981</td>
    </tr>
    <tr>
      <th>12330</th>
      <td>summer</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>23.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>clear</td>
      <td>22.96</td>
      <td>26.515</td>
      <td>0.52</td>
      <td>7.0015</td>
    </tr>
  </tbody>
</table>
<p>10000 rows × 12 columns</p>
</div>
</div>
<br />
<br /><p>We now inspect the last split:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">train_4</span><span class="p">,</span> <span class="n">test_4</span> <span class="o">=</span> <span class="n">all_splits</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_4</span><span class="p">]</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>year</th>
      <th>month</th>
      <th>hour</th>
      <th>holiday</th>
      <th>weekday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>feel_temp</th>
      <th>humidity</th>
      <th>windspeed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>16379</th>
      <td>winter</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>5.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>misty</td>
      <td>13.94</td>
      <td>16.665</td>
      <td>0.66</td>
      <td>8.9981</td>
    </tr>
    <tr>
      <th>16380</th>
      <td>winter</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>6.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>misty</td>
      <td>13.94</td>
      <td>16.665</td>
      <td>0.71</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>16381</th>
      <td>winter</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>7.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>clear</td>
      <td>13.12</td>
      <td>16.665</td>
      <td>0.76</td>
      <td>6.0032</td>
    </tr>
    <tr>
      <th>16382</th>
      <td>winter</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>8.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>clear</td>
      <td>13.94</td>
      <td>16.665</td>
      <td>0.71</td>
      <td>8.9981</td>
    </tr>
    <tr>
      <th>16383</th>
      <td>winter</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>9.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>misty</td>
      <td>14.76</td>
      <td>18.940</td>
      <td>0.71</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17374</th>
      <td>spring</td>
      <td>1.0</td>
      <td>12.0</td>
      <td>19.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>misty</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>0.60</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>17375</th>
      <td>spring</td>
      <td>1.0</td>
      <td>12.0</td>
      <td>20.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>misty</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>0.60</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>17376</th>
      <td>spring</td>
      <td>1.0</td>
      <td>12.0</td>
      <td>21.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>0.60</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>17377</th>
      <td>spring</td>
      <td>1.0</td>
      <td>12.0</td>
      <td>22.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>0.56</td>
      <td>8.9981</td>
    </tr>
    <tr>
      <th>17378</th>
      <td>spring</td>
      <td>1.0</td>
      <td>12.0</td>
      <td>23.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>0.65</td>
      <td>8.9981</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 12 columns</p>
</div>
</div>
<br />
<br /><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_4</span><span class="p">]</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>year</th>
      <th>month</th>
      <th>hour</th>
      <th>holiday</th>
      <th>weekday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>feel_temp</th>
      <th>humidity</th>
      <th>windspeed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6331</th>
      <td>winter</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>9.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>misty</td>
      <td>26.24</td>
      <td>28.790</td>
      <td>0.89</td>
      <td>12.9980</td>
    </tr>
    <tr>
      <th>6332</th>
      <td>winter</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>10.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>misty</td>
      <td>26.24</td>
      <td>28.790</td>
      <td>0.89</td>
      <td>12.9980</td>
    </tr>
    <tr>
      <th>6333</th>
      <td>winter</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>11.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>clear</td>
      <td>27.88</td>
      <td>31.820</td>
      <td>0.79</td>
      <td>15.0013</td>
    </tr>
    <tr>
      <th>6334</th>
      <td>winter</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>12.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>misty</td>
      <td>27.88</td>
      <td>31.820</td>
      <td>0.79</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>6335</th>
      <td>winter</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>13.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>misty</td>
      <td>28.70</td>
      <td>33.335</td>
      <td>0.74</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16326</th>
      <td>winter</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>0.0</td>
      <td>False</td>
      <td>0.0</td>
      <td>False</td>
      <td>misty</td>
      <td>12.30</td>
      <td>15.150</td>
      <td>0.70</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>16327</th>
      <td>winter</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>1.0</td>
      <td>False</td>
      <td>0.0</td>
      <td>False</td>
      <td>clear</td>
      <td>12.30</td>
      <td>14.395</td>
      <td>0.70</td>
      <td>12.9980</td>
    </tr>
    <tr>
      <th>16328</th>
      <td>winter</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>2.0</td>
      <td>False</td>
      <td>0.0</td>
      <td>False</td>
      <td>clear</td>
      <td>11.48</td>
      <td>14.395</td>
      <td>0.81</td>
      <td>7.0015</td>
    </tr>
    <tr>
      <th>16329</th>
      <td>winter</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>3.0</td>
      <td>False</td>
      <td>0.0</td>
      <td>False</td>
      <td>misty</td>
      <td>12.30</td>
      <td>15.150</td>
      <td>0.81</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>16330</th>
      <td>winter</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>4.0</td>
      <td>False</td>
      <td>0.0</td>
      <td>False</td>
      <td>misty</td>
      <td>12.30</td>
      <td>14.395</td>
      <td>0.81</td>
      <td>12.9980</td>
    </tr>
  </tbody>
</table>
<p>10000 rows × 12 columns</p>
</div>
</div>
<br />
<br /><p>All is well. We are now ready to do some predictive modeling!</p>
</section>
<section id="gradient-boosting">
<h2>Gradient Boosting<a class="headerlink" href="#gradient-boosting" title="Permalink to this headline">¶</a></h2>
<p>Gradient Boosting Regression with decision trees is often flexible enough to
efficiently handle heteorogenous tabular data with a mix of categorical and
numerical features as long as the number of samples is large enough.</p>
<p>Here, we do minimal ordinal encoding for the categorical variables and then
let the model know that it should treat those as categorical variables by
using a dedicated tree splitting rule. Since we use an ordinal encoder, we
pass the list of categorical values explicitly to use a logical order when
encoding the categories as integers instead of the lexicographical order.
This also has the added benefit of preventing any issue with unknown
categories when using cross-validation.</p>
<p>The numerical variables need no preprocessing and, for the sake of simplicity,
we only try the default hyper-parameters for this model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;weather&quot;</span><span class="p">,</span>
    <span class="s2">&quot;season&quot;</span><span class="p">,</span>
    <span class="s2">&quot;holiday&quot;</span><span class="p">,</span>
    <span class="s2">&quot;workingday&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">non_categorical_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categorical_columns</span><span class="p">]</span>
<span class="n">categories</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;clear&quot;</span><span class="p">,</span> <span class="s2">&quot;misty&quot;</span><span class="p">,</span> <span class="s2">&quot;rain&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;spring&quot;</span><span class="p">,</span> <span class="s2">&quot;summer&quot;</span><span class="p">,</span> <span class="s2">&quot;fall&quot;</span><span class="p">,</span> <span class="s2">&quot;winter&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">],</span>
<span class="p">]</span>
<span class="n">ordinal_encoder</span> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OrdinalEncoder.html#sklearn.preprocessing.OrdinalEncoder" title="sklearn.preprocessing.OrdinalEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">OrdinalEncoder</span></a><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">categories</span><span class="p">)</span>


<span class="n">gbrt_pipeline</span> <span class="o">=</span> <a href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline" class="sphx-glr-backref-module-neuraxle-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Pipeline</span></a><span class="p">([</span>
    <a href="../../api/steps/neuraxle.steps.column_transformer.html#neuraxle.steps.column_transformer.ColumnTransformer" title="neuraxle.steps.column_transformer.ColumnTransformer" class="sphx-glr-backref-module-neuraxle-steps-column_transformer sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ColumnTransformer</span></a><span class="p">([</span>
        <span class="p">(</span><span class="n">categorical_columns</span><span class="p">,</span> <span class="n">ordinal_encoder</span><span class="p">),</span>
        <span class="p">(</span><span class="n">non_categorical_columns</span><span class="p">,</span> <a href="../../api/neuraxle.base.html#neuraxle.base.Identity" title="neuraxle.base.Identity" class="sphx-glr-backref-module-neuraxle-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Identity</span></a><span class="p">()),</span>
    <span class="p">],</span> <span class="n">n_dimension</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingRegressor.html#sklearn.ensemble.HistGradientBoostingRegressor" title="sklearn.ensemble.HistGradientBoostingRegressor" class="sphx-glr-backref-module-sklearn-ensemble sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">HistGradientBoostingRegressor</span></a><span class="p">(</span>
        <span class="n">categorical_features</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>Lets evaluate our gradient boosting model with the mean absolute error of the
relative demand averaged accross our 5 time-based cross-validation splits:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">SilentMetaStep</span><span class="p">(</span><a href="../../api/neuraxle.base.html#neuraxle.base.MetaStep" title="neuraxle.base.MetaStep" class="sphx-glr-backref-module-neuraxle-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MetaStep</span></a><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This class is needed here to disable the sklearn compatibility errors with the getters and setters.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">wrapped</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">silent_model</span> <span class="o">=</span> <span class="n">SilentMetaStep</span><span class="p">()</span>
    <span class="n">cv_results</span> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_validate.html#sklearn.model_selection.cross_validate" title="sklearn.model_selection.cross_validate" class="sphx-glr-backref-module-sklearn-model_selection sphx-glr-backref-type-py-function"><span class="n">cross_validate</span></a><span class="p">(</span>
        <span class="n">silent_model</span><span class="p">,</span>
        <span class="n">X</span><span class="p">,</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
        <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;neg_mean_absolute_error&quot;</span><span class="p">,</span> <span class="s2">&quot;neg_root_mean_squared_error&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="o">-</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_neg_mean_absolute_error&quot;</span><span class="p">]</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="o">-</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_neg_root_mean_squared_error&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Evaluation results for </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;    Mean Absolute Error:     </span><span class="si">{</span><span class="n">mae</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">mae</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;    Root Mean Squared Error: </span><span class="si">{</span><span class="n">rmse</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">rmse</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>


<span class="n">evaluate</span><span class="p">(</span><span class="n">gbrt_pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ts_cv</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Evaluation results for Pipeline([
    ColumnTransformer([
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OrdinalEncoder(...)) object 0x7ff2829a1790&gt;,
        ], name=&#39;[&#39;weather&#39;, &#39;season&#39;, &#39;holiday&#39;, &#39;workingday&#39;]_OrdinalEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            Identity(name=&#39;Identity&#39;),
        ], name=&#39;[&#39;year&#39;, &#39;month&#39;, &#39;hour&#39;, &#39;weekday&#39;, &#39;temp&#39;, &#39;feel_temp&#39;, &#39;humidity&#39;, &#39;windspeed&#39;]_Identity&#39;),
        NumpyConcatenateInnerFeatures(name=&#39;joiner&#39;),
    ], name=&#39;ColumnTransformer&#39;),
    &lt;neuraxle.steps.sklearn.SKLearnWrapper(HistGradientBoostingRegressor(...)) object 0x7ff2829a1d30&gt;,
], name=&#39;Pipeline&#39;):

    Mean Absolute Error:     0.043 +/- 0.003
    Root Mean Squared Error: 0.066 +/- 0.005
</pre></div>
</div>
<p>This model has an average error around 4 to 5% of the maximum demand. This is
quite good for a first trial without any hyper-parameter tuning! We just had
to make the categorical variables explicit. Note that the time related
features are passed as is, i.e. without processing them. But this is not much
of a problem for tree-based models as they can learn a non-monotonic
relationship between ordinal input features and the target.</p>
<p>This is not the case for linear regression models as we will see in the
following.</p>
</section>
<section id="naive-linear-regression">
<h2>Naive linear regression<a class="headerlink" href="#naive-linear-regression" title="Permalink to this headline">¶</a></h2>
<p>As usual for linear models, categorical variables need to be one-hot encoded.
For consistency, we scale the numerical features to the same 0-1 range using
class:<cite>sklearn.preprocessing.MinMaxScaler</cite>, although in this case it does not
impact the results much because they are already on comparable scales:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_one_hot_encoders</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">col_name</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder" title="sklearn.preprocessing.OneHotEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">OneHotEncoder</span></a><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">categorical_columns</span>
<span class="p">]</span>
<span class="n">alphas</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.16.1/reference/generated/numpy.logspace.html#numpy.logspace" title="numpy.logspace" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">logspace</span></a><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">naive_linear_pipeline</span> <span class="o">=</span> <a href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline" class="sphx-glr-backref-module-neuraxle-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Pipeline</span></a><span class="p">([</span>
    <a href="../../api/steps/neuraxle.steps.column_transformer.html#neuraxle.steps.column_transformer.ColumnTransformer" title="neuraxle.steps.column_transformer.ColumnTransformer" class="sphx-glr-backref-module-neuraxle-steps-column_transformer sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ColumnTransformer</span></a><span class="p">([</span>
        <span class="o">*</span><span class="n">categorical_one_hot_encoders</span><span class="p">,</span>
        <span class="p">(</span><span class="n">non_categorical_columns</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html#sklearn.preprocessing.MinMaxScaler" title="sklearn.preprocessing.MinMaxScaler" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MinMaxScaler</span></a><span class="p">()),</span>
    <span class="p">],</span> <span class="n">n_dimension</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeCV.html#sklearn.linear_model.RidgeCV" title="sklearn.linear_model.RidgeCV" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RidgeCV</span></a><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">evaluate</span><span class="p">(</span><span class="n">naive_linear_pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ts_cv</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Evaluation results for Pipeline([
    ColumnTransformer([
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829edb80&gt;,
        ], name=&#39;weather_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829a3100&gt;,
        ], name=&#39;season_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829a3430&gt;,
        ], name=&#39;holiday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829a3e50&gt;,
        ], name=&#39;workingday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(MinMaxScaler(...)) object 0x7ff2829a3940&gt;,
        ], name=&#39;[&#39;year&#39;, &#39;month&#39;, &#39;hour&#39;, &#39;weekday&#39;, &#39;temp&#39;, &#39;feel_temp&#39;, &#39;humidity&#39;, &#39;windspeed&#39;]_MinMaxScaler&#39;),
        NumpyConcatenateInnerFeatures(name=&#39;joiner&#39;),
    ], name=&#39;ColumnTransformer&#39;),
    &lt;neuraxle.steps.sklearn.SKLearnWrapper(RidgeCV(...)) object 0x7ff2829a3be0&gt;,
], name=&#39;Pipeline&#39;):

    Mean Absolute Error:     0.139 +/- 0.014
    Root Mean Squared Error: 0.180 +/- 0.020
</pre></div>
</div>
<p>The performance is not good: the average error is around 14% of the maximum
demand. This is more than three times higher than the average error of the
gradient boosting model. We can suspect that the naive original encoding
(merely min-max scaled) of the periodic time-related features might prevent
the linear regression model to properly leverage the time information: linear
regression does not automatically model non-monotonic relationships between
the input features and the target. Non-linear terms have to be engineered in
the input.</p>
<p>For example, the raw numerical encoding of the <cite>“hour”</cite> feature prevents the
linear model from recognizing that an increase of hour in the morning from 6
to 8 should have a strong positive impact on the number of bike rentals while
an increase of similar magnitude in the evening from 18 to 20 should have a
strong negative impact on the predicted number of bike rentals.</p>
</section>
<section id="time-steps-as-categories">
<h2>Time-steps as categories<a class="headerlink" href="#time-steps-as-categories" title="Permalink to this headline">¶</a></h2>
<p>Since the time features are encoded in a discrete manner using integers (24
unique values in the “hours” feature), we could decide to treat those as
categorical variables using a one-hot encoding and thereby ignore any
assumption implied by the ordering of the hour values.</p>
<p>Using one-hot encoding for the time features gives the linear model a lot
more flexibility as we introduce one additional feature per discrete time
level.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hour_weekday_month</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">]</span>
<span class="n">non_time_non_categorical_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">non_categorical_columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hour_weekday_month</span><span class="p">]</span>

<span class="n">time_one_hot_encoders</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">col_name</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder" title="sklearn.preprocessing.OneHotEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">OneHotEncoder</span></a><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">hour_weekday_month</span>
<span class="p">]</span>

<span class="n">one_hot_linear_pipeline</span> <span class="o">=</span> <a href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline" class="sphx-glr-backref-module-neuraxle-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Pipeline</span></a><span class="p">([</span>
    <a href="../../api/steps/neuraxle.steps.column_transformer.html#neuraxle.steps.column_transformer.ColumnTransformer" title="neuraxle.steps.column_transformer.ColumnTransformer" class="sphx-glr-backref-module-neuraxle-steps-column_transformer sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ColumnTransformer</span></a><span class="p">([</span>
        <span class="o">*</span><span class="n">categorical_one_hot_encoders</span><span class="p">,</span>
        <span class="o">*</span><span class="n">time_one_hot_encoders</span><span class="p">,</span>
        <span class="p">(</span><span class="n">non_time_non_categorical_columns</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html#sklearn.preprocessing.MinMaxScaler" title="sklearn.preprocessing.MinMaxScaler" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MinMaxScaler</span></a><span class="p">()),</span>
    <span class="p">],</span> <span class="n">n_dimension</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeCV.html#sklearn.linear_model.RidgeCV" title="sklearn.linear_model.RidgeCV" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RidgeCV</span></a><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">evaluate</span><span class="p">(</span><span class="n">one_hot_linear_pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ts_cv</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Evaluation results for Pipeline([
    ColumnTransformer([
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff282952490&gt;,
        ], name=&#39;weather_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff282952e80&gt;,
        ], name=&#39;season_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff282952fa0&gt;,
        ], name=&#39;holiday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829ed970&gt;,
        ], name=&#39;workingday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829ac790&gt;,
        ], name=&#39;hour_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829acfd0&gt;,
        ], name=&#39;weekday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829ac610&gt;,
        ], name=&#39;month_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(MinMaxScaler(...)) object 0x7ff2829aca60&gt;,
        ], name=&#39;[&#39;year&#39;, &#39;temp&#39;, &#39;feel_temp&#39;, &#39;humidity&#39;, &#39;windspeed&#39;]_MinMaxScaler&#39;),
        NumpyConcatenateInnerFeatures(name=&#39;joiner&#39;),
    ], name=&#39;ColumnTransformer&#39;),
    &lt;neuraxle.steps.sklearn.SKLearnWrapper(RidgeCV(...)) object 0x7ff282964a60&gt;,
], name=&#39;Pipeline&#39;):

    Mean Absolute Error:     0.096 +/- 0.010
    Root Mean Squared Error: 0.128 +/- 0.010
</pre></div>
</div>
<p>The average error rate of this model is 10% which is much better than using
the original (ordinal) encoding of the time feature, confirming our intuition
that the linear regression model benefits from the added flexibility to not
treat time progression in a monotonic manner.</p>
<p>However, this introduces a very large number of new features. If the time of
the day was represented in minutes since the start of the day instead of
hours, one-hot encoding would have introduced 1440 features instead of 24.
This could cause some significant overfitting. To avoid this we could use
<code class="xref py py-func docutils literal notranslate"><span class="pre">sklearn.preprocessing.KBinsDiscretizer()</span></code> instead to re-bin the number
of levels of fine-grained ordinal or numerical variables while still
benefitting from the non-monotonic expressivity advantages of one-hot
encoding.</p>
<p>Finally, we also observe that one-hot encoding completely ignores the
ordering of the hour levels while this could be an interesting inductive bias
to preserve to some level. In the following we try to explore smooth,
non-monotonic encoding that locally preserves the relative ordering of time
features.</p>
</section>
<section id="trigonometric-features">
<h2>Trigonometric features<a class="headerlink" href="#trigonometric-features" title="Permalink to this headline">¶</a></h2>
<p>As a first attempt, we can try to encode each of those periodic features
using a sine and cosine transformation with the matching period.</p>
<p>Each ordinal time feature is transformed into 2 features that together encode
equivalent information in a non-monotonic way, and more importantly without
any jump between the first and the last value of the periodic range.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sin_transformer</span><span class="p">(</span><span class="n">period</span><span class="p">):</span>
    <span class="k">return</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.FunctionTransformer.html#sklearn.preprocessing.FunctionTransformer" title="sklearn.preprocessing.FunctionTransformer" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">FunctionTransformer</span></a><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <a href="http://docs.scipy.org/doc/numpy-1.16.1/reference/generated/numpy.sin.html#numpy.sin" title="numpy.sin" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">sin</span></a><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">period</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <a href="http://docs.scipy.org/doc/numpy-1.16.1/reference/constants.html#numpy.pi" title="numpy.pi" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a><span class="p">))</span>


<span class="k">def</span> <span class="nf">cos_transformer</span><span class="p">(</span><span class="n">period</span><span class="p">):</span>
    <span class="k">return</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.FunctionTransformer.html#sklearn.preprocessing.FunctionTransformer" title="sklearn.preprocessing.FunctionTransformer" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">FunctionTransformer</span></a><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <a href="http://docs.scipy.org/doc/numpy-1.16.1/reference/generated/numpy.cos.html#numpy.cos" title="numpy.cos" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">cos</span></a><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">period</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <a href="http://docs.scipy.org/doc/numpy-1.16.1/reference/constants.html#numpy.pi" title="numpy.pi" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a><span class="p">))</span>
</pre></div>
</div>
<p>Let us visualize the effect of this feature expansion on some synthetic hour
data with a bit of extrapolation beyond hour=23:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hour_df</span> <span class="o">=</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></a><span class="p">(</span>
    <a href="http://docs.scipy.org/doc/numpy-1.16.1/reference/generated/numpy.arange.html#numpy.arange" title="numpy.arange" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="mi">26</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">hour_df</span><span class="p">[</span><span class="s2">&quot;hour_sin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sin_transformer</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">hour_df</span><span class="p">)[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span>
<span class="n">hour_df</span><span class="p">[</span><span class="s2">&quot;hour_cos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cos_transformer</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">hour_df</span><span class="p">)[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span>
<span class="n">hour_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.title.html#matplotlib.pyplot.title" title="matplotlib.pyplot.title" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">title</span></a><span class="p">(</span><span class="s2">&quot;Trigonometric encoding for the &#39;hour&#39; feature&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_cyclical_feature_engineering_003.png" srcset="../../_images/sphx_glr_plot_cyclical_feature_engineering_003.png" alt="Trigonometric encoding for the 'hour' feature" class = "sphx-glr-single-img"/><p>Let’s use a 2D scatter plot with the hours encoded as colors to better see
how this representation maps the 24 hours of the day to a 2D space, akin to
some sort of a 24 hour version of an analog clock. Note that the “25th” hour
is mapped back to the 1st hour because of the periodic nature of the
sine/cosine representation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">hour_df</span><span class="p">[</span><span class="s2">&quot;hour_sin&quot;</span><span class="p">],</span> <span class="n">hour_df</span><span class="p">[</span><span class="s2">&quot;hour_cos&quot;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">hour_df</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;sin(hour)&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;cos(hour)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_cyclical_feature_engineering_004.png" srcset="../../_images/sphx_glr_plot_cyclical_feature_engineering_004.png" alt="plot cyclical feature engineering" class = "sphx-glr-single-img"/><p>We can now build a feature extraction pipeline using this strategy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cyclic_cossin_transformer</span> <span class="o">=</span> <a href="../../api/steps/neuraxle.steps.column_transformer.html#neuraxle.steps.column_transformer.ColumnTransformer" title="neuraxle.steps.column_transformer.ColumnTransformer" class="sphx-glr-backref-module-neuraxle-steps-column_transformer sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ColumnTransformer</span></a><span class="p">([</span>
    <span class="o">*</span><span class="n">categorical_one_hot_encoders</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="n">sin_transformer</span><span class="p">(</span><span class="mi">12</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="n">cos_transformer</span><span class="p">(</span><span class="mi">12</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="n">sin_transformer</span><span class="p">(</span><span class="mi">7</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="n">cos_transformer</span><span class="p">(</span><span class="mi">7</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">sin_transformer</span><span class="p">(</span><span class="mi">24</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">cos_transformer</span><span class="p">(</span><span class="mi">24</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">non_time_non_categorical_columns</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html#sklearn.preprocessing.MinMaxScaler" title="sklearn.preprocessing.MinMaxScaler" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MinMaxScaler</span></a><span class="p">()),</span>
<span class="p">],</span> <span class="n">n_dimension</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">cyclic_cossin_linear_pipeline</span> <span class="o">=</span> <a href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline" class="sphx-glr-backref-module-neuraxle-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Pipeline</span></a><span class="p">([</span>
    <span class="n">cyclic_cossin_transformer</span><span class="p">,</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeCV.html#sklearn.linear_model.RidgeCV" title="sklearn.linear_model.RidgeCV" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RidgeCV</span></a><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">evaluate</span><span class="p">(</span><span class="n">cyclic_cossin_linear_pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ts_cv</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Evaluation results for Pipeline([
    ColumnTransformer([
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff1897ba850&gt;,
        ], name=&#39;weather_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff1896fe580&gt;,
        ], name=&#39;season_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff189707850&gt;,
        ], name=&#39;holiday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff189707730&gt;,
        ], name=&#39;workingday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(FunctionTransformer(...)) object 0x7ff189707e80&gt;,
        ], name=&#39;month_FunctionTransformer&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(FunctionTransformer(...)) object 0x7ff18970e190&gt;,
        ], name=&#39;month_FunctionTransformer1&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(FunctionTransformer(...)) object 0x7ff18970e4c0&gt;,
        ], name=&#39;weekday_FunctionTransformer&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(FunctionTransformer(...)) object 0x7ff18970e820&gt;,
        ], name=&#39;weekday_FunctionTransformer1&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(FunctionTransformer(...)) object 0x7ff18970eb80&gt;,
        ], name=&#39;hour_FunctionTransformer&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(FunctionTransformer(...)) object 0x7ff18970ef10&gt;,
        ], name=&#39;hour_FunctionTransformer1&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(MinMaxScaler(...)) object 0x7ff189718280&gt;,
        ], name=&#39;[&#39;year&#39;, &#39;temp&#39;, &#39;feel_temp&#39;, &#39;humidity&#39;, &#39;windspeed&#39;]_MinMaxScaler&#39;),
        NumpyConcatenateInnerFeatures(name=&#39;joiner&#39;),
    ], name=&#39;ColumnTransformer&#39;),
    &lt;neuraxle.steps.sklearn.SKLearnWrapper(RidgeCV(...)) object 0x7ff189718550&gt;,
], name=&#39;Pipeline&#39;):

    Mean Absolute Error:     0.122 +/- 0.013
    Root Mean Squared Error: 0.162 +/- 0.019
</pre></div>
</div>
<p>The performance of our linear regression model with this simple feature
engineering is a bit better than using the original ordinal time features but
worse than using the one-hot encoded time features. We will further analyze
possible reasons for this disappointing outcome at the end of this notebook.</p>
</section>
<section id="periodic-spline-features">
<h2>Periodic spline features<a class="headerlink" href="#periodic-spline-features" title="Permalink to this headline">¶</a></h2>
<p>We can try an alternative encoding of the periodic time-related features
using spline transformations with a large enough number of splines, and as a
result a larger number of expanded features compared to the sine/cosine
transformation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">periodic_spline_transformer</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n_splines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_splines</span> <span class="o">=</span> <span class="n">period</span>
    <span class="n">n_knots</span> <span class="o">=</span> <span class="n">n_splines</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># periodic and include_bias is True</span>
    <span class="k">return</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.SplineTransformer.html#sklearn.preprocessing.SplineTransformer" title="sklearn.preprocessing.SplineTransformer" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">SplineTransformer</span></a><span class="p">(</span>
        <span class="n">degree</span><span class="o">=</span><span class="n">degree</span><span class="p">,</span>
        <span class="n">n_knots</span><span class="o">=</span><span class="n">n_knots</span><span class="p">,</span>
        <span class="n">knots</span><span class="o">=</span><a href="http://docs.scipy.org/doc/numpy-1.16.1/reference/generated/numpy.linspace.html#numpy.linspace" title="numpy.linspace" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">n_knots</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_knots</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">extrapolation</span><span class="o">=</span><span class="s2">&quot;periodic&quot;</span><span class="p">,</span>
        <span class="n">include_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Again, let us visualize the effect of this feature expansion on some
synthetic hour data with a bit of extrapolation beyond hour=23:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hour_df</span> <span class="o">=</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></a><span class="p">(</span>
    <a href="http://docs.scipy.org/doc/numpy-1.16.1/reference/generated/numpy.linspace.html#numpy.linspace" title="numpy.linspace" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">splines</span> <span class="o">=</span> <span class="n">periodic_spline_transformer</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">hour_df</span><span class="p">)</span>
<span class="n">splines_df</span> <span class="o">=</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></a><span class="p">(</span>
    <span class="n">splines</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;spline_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">splines</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span>
<span class="p">)</span>
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html#pandas.concat" title="pandas.concat" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-function"><span class="n">pd</span><span class="o">.</span><span class="n">concat</span></a><span class="p">([</span><span class="n">hour_df</span><span class="p">,</span> <span class="n">splines_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20b</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.title.html#matplotlib.pyplot.title" title="matplotlib.pyplot.title" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">title</span></a><span class="p">(</span><span class="s2">&quot;Periodic spline-based encoding for the &#39;hour&#39; feature&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_cyclical_feature_engineering_005.png" srcset="../../_images/sphx_glr_plot_cyclical_feature_engineering_005.png" alt="Periodic spline-based encoding for the 'hour' feature" class = "sphx-glr-single-img"/><p>Thanks to the use of the <cite>extrapolation=”periodic”</cite> parameter, we observe
that the feature encoding stays smooth when extrapolating beyond midnight.</p>
<p>We can now build a predictive pipeline using this alternative periodic
feature engineering strategy.</p>
<p>It is possible to use fewer splines than discrete levels for those ordinal
values. This makes spline-based encoding more efficient than one-hot encoding
while preserving most of the expressivity:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cyclic_spline_transformer</span> <span class="o">=</span> <a href="../../api/steps/neuraxle.steps.column_transformer.html#neuraxle.steps.column_transformer.ColumnTransformer" title="neuraxle.steps.column_transformer.ColumnTransformer" class="sphx-glr-backref-module-neuraxle-steps-column_transformer sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ColumnTransformer</span></a><span class="p">([</span>
    <span class="o">*</span><span class="n">categorical_one_hot_encoders</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="n">periodic_spline_transformer</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="mi">6</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="n">periodic_spline_transformer</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">periodic_spline_transformer</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="mi">12</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">non_time_non_categorical_columns</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html#sklearn.preprocessing.MinMaxScaler" title="sklearn.preprocessing.MinMaxScaler" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MinMaxScaler</span></a><span class="p">()),</span>
<span class="p">],</span> <span class="n">n_dimension</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">cyclic_spline_linear_pipeline</span> <span class="o">=</span> <a href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline" class="sphx-glr-backref-module-neuraxle-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Pipeline</span></a><span class="p">([</span>
    <span class="n">cyclic_spline_transformer</span><span class="p">,</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeCV.html#sklearn.linear_model.RidgeCV" title="sklearn.linear_model.RidgeCV" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RidgeCV</span></a><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">evaluate</span><span class="p">(</span><span class="n">cyclic_spline_linear_pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ts_cv</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Evaluation results for Pipeline([
    ColumnTransformer([
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff189718df0&gt;,
        ], name=&#39;weather_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829e5970&gt;,
        ], name=&#39;season_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff282952940&gt;,
        ], name=&#39;holiday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff189653970&gt;,
        ], name=&#39;workingday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(SplineTransformer(...)) object 0x7ff189653d90&gt;,
        ], name=&#39;month_SplineTransformer&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(SplineTransformer(...)) object 0x7ff189773850&gt;,
        ], name=&#39;weekday_SplineTransformer&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(SplineTransformer(...)) object 0x7ff18965b1c0&gt;,
        ], name=&#39;hour_SplineTransformer&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(MinMaxScaler(...)) object 0x7ff18965b550&gt;,
        ], name=&#39;[&#39;year&#39;, &#39;temp&#39;, &#39;feel_temp&#39;, &#39;humidity&#39;, &#39;windspeed&#39;]_MinMaxScaler&#39;),
        NumpyConcatenateInnerFeatures(name=&#39;joiner&#39;),
    ], name=&#39;ColumnTransformer&#39;),
    &lt;neuraxle.steps.sklearn.SKLearnWrapper(RidgeCV(...)) object 0x7ff18965b820&gt;,
], name=&#39;Pipeline&#39;):

    Mean Absolute Error:     0.095 +/- 0.011
    Root Mean Squared Error: 0.129 +/- 0.012
</pre></div>
</div>
<p>Spline features make it possible for the linear model to successfully
leverage the periodic time-related features and reduce the error from ~14% to
~10% of the maximum demand, which is similar to what we observed with the
one-hot encoded features.</p>
</section>
<section id="qualitative-analysis-of-the-impact-of-features-on-linear-model-predictions">
<h2>Qualitative analysis of the impact of features on linear model predictions<a class="headerlink" href="#qualitative-analysis-of-the-impact-of-features-on-linear-model-predictions" title="Permalink to this headline">¶</a></h2>
<p>Here, we want to visualize the impact of the feature engineering choices on
the time related shape of the predictions.</p>
<p>To do so we consider an arbitrary time-based split to compare the predictions
on a range of held out data points.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">naive_linear_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">])</span>
<span class="n">naive_linear_predictions</span> <span class="o">=</span> <span class="n">naive_linear_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">])</span>

<span class="n">one_hot_linear_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">])</span>
<span class="n">one_hot_linear_predictions</span> <span class="o">=</span> <span class="n">one_hot_linear_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">])</span>

<span class="n">cyclic_cossin_linear_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">])</span>
<span class="n">cyclic_cossin_linear_predictions</span> <span class="o">=</span> <span class="n">cyclic_cossin_linear_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">])</span>

<span class="n">cyclic_spline_linear_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">])</span>
<span class="n">cyclic_spline_linear_predictions</span> <span class="o">=</span> <span class="n">cyclic_spline_linear_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">])</span>
</pre></div>
</div>
<p>We visualize those predictions by zooming on the last 96 hours (4 days) of
the test set to get some qualitative insights:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">last_hours</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">96</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Predictions by linear models&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">last_hours</span><span class="p">],</span>
    <span class="s2">&quot;x-&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual demand&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">naive_linear_predictions</span><span class="p">[</span><span class="n">last_hours</span><span class="p">],</span> <span class="s2">&quot;x-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ordinal time features&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">cyclic_cossin_linear_predictions</span><span class="p">[</span><span class="n">last_hours</span><span class="p">],</span>
    <span class="s2">&quot;x-&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trigonometric time features&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">cyclic_spline_linear_predictions</span><span class="p">[</span><span class="n">last_hours</span><span class="p">],</span>
    <span class="s2">&quot;x-&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Spline-based time features&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">one_hot_linear_predictions</span><span class="p">[</span><span class="n">last_hours</span><span class="p">],</span>
    <span class="s2">&quot;x-&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;One-hot time features&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_cyclical_feature_engineering_006.png" srcset="../../_images/sphx_glr_plot_cyclical_feature_engineering_006.png" alt="Predictions by linear models" class = "sphx-glr-single-img"/><p>We can draw the following conclusions from the above plot:</p>
<ul class="simple">
<li><p>The <strong>raw ordinal time-related features</strong> are problematic because they do
not capture the natural periodicity: we observe a big jump in the
predictions at the end of each day when the hour features goes from 23 back
to 0. We can expect similar artifacts at the end of each week or each year.</p></li>
<li><p>As expected, the <strong>trigonometric features</strong> (sine and cosine) do not have
these discontinuities at midnight, but the linear regression model fails to
leverage those features to properly model intra-day variations.
Using trigonometric features for higher harmonics or additional
trigonometric features for the natural period with different phases could
potentially fix this problem.</p></li>
<li><p>the <strong>periodic spline-based features</strong> fix those two problems at once: they
give more expressivity to the linear model by making it possible to focus
on specific hours thanks to the use of 12 splines. Furthermore the
<cite>extrapolation=”periodic”</cite> option enforces a smooth representation between
<cite>hour=23</cite> and <cite>hour=0</cite>.</p></li>
<li><p>The <strong>one-hot encoded features</strong> behave similarly to the periodic
spline-based features but are more spiky: for instance they can better
model the morning peak during the week days since this peak lasts shorter
than an hour. However, we will see in the following that what can be an
advantage for linear models is not necessarily one for more expressive
models.</p></li>
</ul>
<p>We can also compare the number of features extracted by each feature
engineering pipeline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">naive_linear_pipeline</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(17379, 19)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">one_hot_linear_pipeline</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(17379, 59)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cyclic_cossin_linear_pipeline</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(17379, 22)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cyclic_spline_linear_pipeline</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(17379, 37)
</pre></div>
</div>
<p>This confirms that the one-hot encoding and the spline encoding strategies
create a lot more features for the time representation than the alternatives,
which in turn gives the downstream linear model more flexibility (degrees of
freedom) to avoid underfitting.</p>
<p>Finally, we observe that none of the linear models can approximate the true
bike rentals demand, especially for the peaks that can be very sharp at rush
hours during the working days but much flatter during the week-ends: the most
accurate linear models based on splines or one-hot encoding tend to forecast
peaks of commuting-related bike rentals even on the week-ends and
under-estimate the commuting-related events during the working days.</p>
<p>These systematic prediction errors reveal a form of under-fitting and can be
explained by the lack of interactions terms between features, e.g.
“workingday” and features derived from “hours”. This issue will be addressed
in the following section.</p>
</section>
<section id="modeling-pairwise-interactions-with-splines-and-polynomial-features">
<h2>Modeling pairwise interactions with splines and polynomial features<a class="headerlink" href="#modeling-pairwise-interactions-with-splines-and-polynomial-features" title="Permalink to this headline">¶</a></h2>
<p>Linear models do not automatically capture interaction effects between input
features. It does not help that some features are marginally non-linear as is
the case with features constructed by <cite>SplineTransformer</cite> (or one-hot
encoding or binning).</p>
<p>However, it is possible to use the <cite>PolynomialFeatures</cite> class on coarse
grained spline encoded hours to model the “workingday”/”hours” interaction
explicitly without introducing too many new variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hour_workday_interaction</span> <span class="o">=</span> <a href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline" class="sphx-glr-backref-module-neuraxle-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Pipeline</span></a><span class="p">([</span>
    <a href="../../api/steps/neuraxle.steps.column_transformer.html#neuraxle.steps.column_transformer.ColumnTransformer" title="neuraxle.steps.column_transformer.ColumnTransformer" class="sphx-glr-backref-module-neuraxle-steps-column_transformer sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ColumnTransformer</span></a><span class="p">([</span>
        <span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">periodic_spline_transformer</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="mi">8</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;workingday&quot;</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.FunctionTransformer.html#sklearn.preprocessing.FunctionTransformer" title="sklearn.preprocessing.FunctionTransformer" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">FunctionTransformer</span></a><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">)),</span>
    <span class="p">],</span> <span class="n">n_dimension</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.PolynomialFeatures.html#sklearn.preprocessing.PolynomialFeatures" title="sklearn.preprocessing.PolynomialFeatures" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">PolynomialFeatures</span></a><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">interaction_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
<p>Those features are then combined with the ones already computed in the
previous spline-base pipeline. We can observe a nice performance improvemnt
by modeling this pairwise interaction explicitly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cyclic_spline_interactions_pipeline</span> <span class="o">=</span> <a href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline" class="sphx-glr-backref-module-neuraxle-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Pipeline</span></a><span class="p">([</span>
    <a href="../../api/neuraxle.union.html#neuraxle.union.FeatureUnion" title="neuraxle.union.FeatureUnion" class="sphx-glr-backref-module-neuraxle-union sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">FeatureUnion</span></a><span class="p">([</span>
        <span class="n">cyclic_spline_transformer</span><span class="p">,</span>
        <span class="n">hour_workday_interaction</span><span class="p">,</span>
    <span class="p">]),</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeCV.html#sklearn.linear_model.RidgeCV" title="sklearn.linear_model.RidgeCV" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RidgeCV</span></a><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">evaluate</span><span class="p">(</span><span class="n">cyclic_spline_interactions_pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ts_cv</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Evaluation results for Pipeline([
    FeatureUnion([
        ColumnTransformer([
            Pipeline([
                ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
                &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff189718df0&gt;,
            ], name=&#39;weather_OneHotEncoder&#39;),
            Pipeline([
                ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
                &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829e5970&gt;,
            ], name=&#39;season_OneHotEncoder&#39;),
            Pipeline([
                ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
                &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff282952940&gt;,
            ], name=&#39;holiday_OneHotEncoder&#39;),
            Pipeline([
                ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
                &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff189653970&gt;,
            ], name=&#39;workingday_OneHotEncoder&#39;),
            Pipeline([
                ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
                &lt;neuraxle.steps.sklearn.SKLearnWrapper(SplineTransformer(...)) object 0x7ff189653d90&gt;,
            ], name=&#39;month_SplineTransformer&#39;),
            Pipeline([
                ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
                &lt;neuraxle.steps.sklearn.SKLearnWrapper(SplineTransformer(...)) object 0x7ff189773850&gt;,
            ], name=&#39;weekday_SplineTransformer&#39;),
            Pipeline([
                ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
                &lt;neuraxle.steps.sklearn.SKLearnWrapper(SplineTransformer(...)) object 0x7ff18965b1c0&gt;,
            ], name=&#39;hour_SplineTransformer&#39;),
            Pipeline([
                ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
                &lt;neuraxle.steps.sklearn.SKLearnWrapper(MinMaxScaler(...)) object 0x7ff18965b550&gt;,
            ], name=&#39;[&#39;year&#39;, &#39;temp&#39;, &#39;feel_temp&#39;, &#39;humidity&#39;, &#39;windspeed&#39;]_MinMaxScaler&#39;),
            NumpyConcatenateInnerFeatures(name=&#39;joiner&#39;),
        ], name=&#39;ColumnTransformer&#39;),
        Pipeline([
            ColumnTransformer([
                Pipeline([
                    ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
                    &lt;neuraxle.steps.sklearn.SKLearnWrapper(SplineTransformer(...)) object 0x7ff1895dca60&gt;,
                ], name=&#39;hour_SplineTransformer&#39;),
                Pipeline([
                    ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
                    &lt;neuraxle.steps.sklearn.SKLearnWrapper(FunctionTransformer(...)) object 0x7ff1896308e0&gt;,
                ], name=&#39;workingday_FunctionTransformer&#39;),
                NumpyConcatenateInnerFeatures(name=&#39;joiner&#39;),
            ], name=&#39;ColumnTransformer&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(PolynomialFeatures(...)) object 0x7ff1895be9d0&gt;,
        ], name=&#39;Pipeline&#39;),
        NumpyConcatenateInnerFeatures(name=&#39;joiner&#39;),
    ], name=&#39;FeatureUnion&#39;),
    &lt;neuraxle.steps.sklearn.SKLearnWrapper(RidgeCV(...)) object 0x7ff1895c9820&gt;,
], name=&#39;Pipeline&#39;):

    Mean Absolute Error:     0.076 +/- 0.008
    Root Mean Squared Error: 0.101 +/- 0.008
</pre></div>
</div>
</section>
<section id="modeling-non-linear-feature-interactions-with-kernels">
<h2>Modeling non-linear feature interactions with kernels<a class="headerlink" href="#modeling-non-linear-feature-interactions-with-kernels" title="Permalink to this headline">¶</a></h2>
<p>The previous analysis highlighted the need to model the interactions between
<cite>“workingday”</cite> and <cite>“hours”</cite>. Another example of a such a non-linear
interaction that we would like to model could be the impact of the rain that
might not be the same during the working days and the week-ends and holidays
for instance.</p>
<p>To model all such interactions, we could either use a polynomial expansion on
all marginal features at once, after their spline-based expansion. However,
this would create a quadratic number of features which can cause overfitting
and computational tractability issues.</p>
<p>Alternatively, we can use the Nyström method to compute an approximate
polynomial kernel expansion. Let us try the latter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cyclic_spline_poly_pipeline</span> <span class="o">=</span> <a href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline" class="sphx-glr-backref-module-neuraxle-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Pipeline</span></a><span class="p">([</span>
    <span class="n">cyclic_spline_transformer</span><span class="p">,</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.kernel_approximation.Nystroem.html#sklearn.kernel_approximation.Nystroem" title="sklearn.kernel_approximation.Nystroem" class="sphx-glr-backref-module-sklearn-kernel_approximation sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Nystroem</span></a><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;poly&quot;</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeCV.html#sklearn.linear_model.RidgeCV" title="sklearn.linear_model.RidgeCV" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RidgeCV</span></a><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">evaluate</span><span class="p">(</span><span class="n">cyclic_spline_poly_pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ts_cv</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Evaluation results for Pipeline([
    ColumnTransformer([
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff189718df0&gt;,
        ], name=&#39;weather_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff2829e5970&gt;,
        ], name=&#39;season_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff282952940&gt;,
        ], name=&#39;holiday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff189653970&gt;,
        ], name=&#39;workingday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(SplineTransformer(...)) object 0x7ff189653d90&gt;,
        ], name=&#39;month_SplineTransformer&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(SplineTransformer(...)) object 0x7ff189773850&gt;,
        ], name=&#39;weekday_SplineTransformer&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(SplineTransformer(...)) object 0x7ff18965b1c0&gt;,
        ], name=&#39;hour_SplineTransformer&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(MinMaxScaler(...)) object 0x7ff18965b550&gt;,
        ], name=&#39;[&#39;year&#39;, &#39;temp&#39;, &#39;feel_temp&#39;, &#39;humidity&#39;, &#39;windspeed&#39;]_MinMaxScaler&#39;),
        NumpyConcatenateInnerFeatures(name=&#39;joiner&#39;),
    ], name=&#39;ColumnTransformer&#39;),
    &lt;neuraxle.steps.sklearn.SKLearnWrapper(Nystroem(...)) object 0x7ff1897ba5e0&gt;,
    &lt;neuraxle.steps.sklearn.SKLearnWrapper(RidgeCV(...)) object 0x7ff189718760&gt;,
], name=&#39;Pipeline&#39;):

    Mean Absolute Error:     0.052 +/- 0.002
    Root Mean Squared Error: 0.074 +/- 0.003
</pre></div>
</div>
<p>We observe that this model can almost rival the performance of the gradient
boosted trees with an average error around 6% of the maximum demand.</p>
<p>Note that while the final step of this pipeline is a linear regression model,
the intermediate steps such as the spline feature extraction and the Nyström
kernel approximation are highly non-linear. As a result the compound pipeline
is much more expressive than a simple linear regression model with raw features.</p>
<p>For the sake of completeness, we also evaluate the combination of one-hot
encoding and kernel approximation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">one_hot_poly_pipeline</span> <span class="o">=</span> <a href="../../api/neuraxle.pipeline.html#neuraxle.pipeline.Pipeline" title="neuraxle.pipeline.Pipeline" class="sphx-glr-backref-module-neuraxle-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Pipeline</span></a><span class="p">([</span>
    <a href="../../api/steps/neuraxle.steps.column_transformer.html#neuraxle.steps.column_transformer.ColumnTransformer" title="neuraxle.steps.column_transformer.ColumnTransformer" class="sphx-glr-backref-module-neuraxle-steps-column_transformer sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ColumnTransformer</span></a><span class="p">([</span>
        <span class="o">*</span><span class="n">categorical_one_hot_encoders</span><span class="p">,</span>
        <span class="o">*</span><span class="n">time_one_hot_encoders</span><span class="p">,</span>
        <span class="p">(</span><span class="n">non_time_non_categorical_columns</span><span class="p">,</span> <a href="../../api/neuraxle.base.html#neuraxle.base.Identity" title="neuraxle.base.Identity" class="sphx-glr-backref-module-neuraxle-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Identity</span></a><span class="p">())</span>  <span class="c1"># passthrough</span>
    <span class="p">],</span> <span class="n">n_dimension</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.kernel_approximation.Nystroem.html#sklearn.kernel_approximation.Nystroem" title="sklearn.kernel_approximation.Nystroem" class="sphx-glr-backref-module-sklearn-kernel_approximation sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">Nystroem</span></a><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;poly&quot;</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeCV.html#sklearn.linear_model.RidgeCV" title="sklearn.linear_model.RidgeCV" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RidgeCV</span></a><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">evaluate</span><span class="p">(</span><span class="n">one_hot_poly_pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ts_cv</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Evaluation results for Pipeline([
    ColumnTransformer([
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff1895e4e50&gt;,
        ], name=&#39;weather_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff1895e4df0&gt;,
        ], name=&#39;season_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff1897d6490&gt;,
        ], name=&#39;holiday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff1897d6040&gt;,
        ], name=&#39;workingday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff1895f5ca0&gt;,
        ], name=&#39;hour_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff189653220&gt;,
        ], name=&#39;weekday_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            &lt;neuraxle.steps.sklearn.SKLearnWrapper(OneHotEncoder(...)) object 0x7ff189649040&gt;,
        ], name=&#39;month_OneHotEncoder&#39;),
        Pipeline([
            ColumnsSelectorND(ColumnSelector2D(name=&#39;ColumnSelector2D&#39;), name=&#39;ColumnsSelectorND&#39;),
            Identity(name=&#39;Identity&#39;),
        ], name=&#39;[&#39;year&#39;, &#39;temp&#39;, &#39;feel_temp&#39;, &#39;humidity&#39;, &#39;windspeed&#39;]_Identity&#39;),
        NumpyConcatenateInnerFeatures(name=&#39;joiner&#39;),
    ], name=&#39;ColumnTransformer&#39;),
    &lt;neuraxle.steps.sklearn.SKLearnWrapper(Nystroem(...)) object 0x7ff189649e80&gt;,
    &lt;neuraxle.steps.sklearn.SKLearnWrapper(RidgeCV(...)) object 0x7ff189649490&gt;,
], name=&#39;Pipeline&#39;):

    Mean Absolute Error:     0.080 +/- 0.006
    Root Mean Squared Error: 0.109 +/- 0.011
</pre></div>
</div>
<p>While one-hot encoded features were competitive with spline-based features
when using linear models, this is no longer the case when using a low-rank
approximation of a non-linear kernel: this can be explained by the fact that
spline features are smoother and allow the kernel approximation to find a
more expressive decision function.</p>
<p>Let us now have a qualitative look at the predictions of the kernel models
and of the gradient boosted trees that should be able to better model
non-linear interactions between features:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gbrt_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">])</span>
<span class="n">gbrt_predictions</span> <span class="o">=</span> <span class="n">gbrt_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">])</span>

<span class="n">one_hot_poly_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">])</span>
<span class="n">one_hot_poly_predictions</span> <span class="o">=</span> <span class="n">one_hot_poly_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">])</span>

<span class="n">cyclic_spline_poly_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_0</span><span class="p">])</span>
<span class="n">cyclic_spline_poly_predictions</span> <span class="o">=</span> <span class="n">cyclic_spline_poly_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">])</span>
</pre></div>
</div>
<p>Again we zoom on the last 4 days of the test set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">last_hours</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">96</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Predictions by non-linear regression models&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">last_hours</span><span class="p">],</span>
    <span class="s2">&quot;x-&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual demand&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">gbrt_predictions</span><span class="p">[</span><span class="n">last_hours</span><span class="p">],</span>
    <span class="s2">&quot;x-&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gradient Boosted Trees&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">one_hot_poly_predictions</span><span class="p">[</span><span class="n">last_hours</span><span class="p">],</span>
    <span class="s2">&quot;x-&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;One-hot + polynomial kernel&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">cyclic_spline_poly_predictions</span><span class="p">[</span><span class="n">last_hours</span><span class="p">],</span>
    <span class="s2">&quot;x-&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Splines + polynomial kernel&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_cyclical_feature_engineering_007.png" srcset="../../_images/sphx_glr_plot_cyclical_feature_engineering_007.png" alt="Predictions by non-linear regression models" class = "sphx-glr-single-img"/><p>First, note that trees can naturally model non-linear feature interactions
since, by default, decision trees are allowed to grow beyond a depth of 2
levels.</p>
<p>Here, we can observe that the combinations of spline features and non-linear
kernels works quite well and can almost rival the accuracy of the gradient
boosting regression trees.</p>
<p>On the contrary, one-hot encoded time features do not perform that well with
the low rank kernel model. In particular, they significantly over-estimate
the low demand hours more than the competing models.</p>
<p>We also observe that none of the models can successfully predict some of the
peak rentals at the rush hours during the working days. It is possible that
access to additional features would be required to further improve the
accuracy of the predictions. For instance, it could be useful to have access
to the geographical repartition of the fleet at any point in time or the
fraction of bikes that are immobilized because they need servicing.</p>
<p>Let us finally get a more quantative look at the prediction errors of those
three models using the true vs predicted demand scatter plots:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Non-linear regression models&quot;</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">one_hot_poly_predictions</span><span class="p">,</span>
    <span class="n">cyclic_spline_poly_predictions</span><span class="p">,</span>
    <span class="n">gbrt_predictions</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;One hot + polynomial kernel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Splines + polynomial kernel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Gradient Boosted Trees&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Perfect model&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;True demand&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Predicted demand&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_cyclical_feature_engineering_008.png" srcset="../../_images/sphx_glr_plot_cyclical_feature_engineering_008.png" alt="Non-linear regression models" class = "sphx-glr-single-img"/><p>This visualization confirms the conclusions we draw on the previous plot.</p>
<p>All models under-estimate the high demand events (working day rush hours),
but gradient boosting a bit less so. The low demand events are well predicted
on average by gradient boosting while the one-hot polynomial regression
pipeline seems to systematically over-estimate demand in that regime. Overall
the predictions of the gradient boosted trees are closer to the diagonal than
for the kernel models.</p>
</section>
<section id="concluding-remarks">
<h2>Concluding remarks<a class="headerlink" href="#concluding-remarks" title="Permalink to this headline">¶</a></h2>
<p>We note that we could have obtained slightly better results for kernel models
by using more components (higher rank kernel approximation) at the cost of
longer fit and prediction durations. For large values of <cite>n_components</cite>, the
performance of the one-hot encoded features would even match the spline
features.</p>
<p>The <cite>Nystroem</cite> + <cite>RidgeCV</cite> regressor could also have been replaced by
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.neural_network.MLPRegressor.html#sklearn.neural_network.MLPRegressor" title="(in scikit-learn v1.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MLPRegressor</span></code></a> with one or two hidden layers
and we would have obtained quite similar results.</p>
<p>The dataset we used in this case study is sampled on a hourly basis. However
cyclic spline-based features could model time-within-day or time-within-week
very efficiently with finer-grained time resolutions (for instance with
measurements taken every minute instead of every hours) without introducing
more features. One-hot encoding time representations would not offer this
flexibility.</p>
<p>Finally, in this notebook we used <cite>RidgeCV</cite> because it is very efficient from
a computational point of view. However, it models the target variable as a
Gaussian random variable with constant variance. For positive regression
problems, it is likely that using a Poisson or Gamma distribution would make
more sense. This could be achieved by using
<cite>GridSearchCV(TweedieRegressor(power=2), param_grid({“alpha”: alphas}))</cite>
instead of <cite>RidgeCV</cite>.</p>
</section>
<section id="source">
<h2>Source<a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some of the code in the current file is adapted from the following
<a class="reference external" href="https://scikit-learn.org/stable/auto_examples/applications/plot_cyclical_feature_engineering.html#sphx-glr-auto-examples-applications-plot-cyclical-feature-engineering-py">scikit-learn documentation example</a>,
and was updated to Neuraxle code for demonstration herein.
Here is the license of the original example:</p>
<p>BSD 3-Clause License</p>
<p>Copyright (c) 2007-2021 The scikit-learn developers.
All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:</p>
<ul class="simple">
<li><p>Redistributions of source code must retain the above copyright notice, this</p></li>
</ul>
<p>list of conditions and the following disclaimer.</p>
<ul class="simple">
<li><p>Redistributions in binary form must reproduce the above copyright notice,</p></li>
</ul>
<p>this list of conditions and the following disclaimer in the documentation
and/or other materials provided with the distribution.</p>
<ul class="simple">
<li><p>Neither the name of the copyright holder nor the names of its</p></li>
</ul>
<p>contributors may be used to endorse or promote products derived from
this software without specific prior written permission.</p>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS”
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 1 minutes  5.534 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-sklearn-plot-cyclical-feature-engineering-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/Neuraxio/Neuraxle/master?urlpath=lab/tree/notebooks/examples/sklearn/plot_cyclical_feature_engineering.ipynb"><img alt="Launch binder" src="../../_images/binder_badge_logo.png" style="width: 150px;" /></a>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/b8726badf1eae802f1838bb008e50ef1/plot_cyclical_feature_engineering.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_cyclical_feature_engineering.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/d02b20056cd2cd890edbf04b6738f7f7/plot_cyclical_feature_engineering.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_cyclical_feature_engineering.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../api.html" class="btn btn-neutral float-right" title="&gt;&gt;&gt; Complete API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plot_boston_housing_meta_optimization.html" class="btn btn-neutral float-left" title="Boston Housing Regression with Meta Optimization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p style="float:left;">
        &copy; Copyright 2021 The Neuraxle Authors. All rights reserved. Apache License, Version 2.0.

    </p>

    <p style="float:right;">
      <a href="https://www.neuraxio.com/policies/privacy-policy">Privacy Policy</a>
    </p>

  </div>
   




</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-139527241-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>